# 프로덕션 배포 가이드

## 🚀 배포 준비 완료 사항

### ✅ 완료된 작업
1. **로컬 테스트 관련 파일 정리** - 모든 로컬 관련 코드 제거
2. **Supabase 연결 최적화** - 프로덕션 환경에 맞게 클라이언트 설정
3. **리얼타임 동기화 개선** - 로비 입장자 수 실시간 업데이트 문제 해결
4. **빌드 오류 수정** - 환경 변수 없이도 빌드 가능하도록 수정
5. **API 에러 핸들링 개선** - 프로덕션 환경에서 안정적인 동작

### 🔧 주요 개선 사항

#### 1. 리얼타임 동기화 최적화
- **홈 페이지**: 참가자 수 실시간 업데이트
- **로비 페이지**: 입장/퇴장 즉시 반영
- **재연결 로직**: 네트워크 문제 시 자동 재연결
- **디바운스**: 과도한 API 호출 방지

#### 2. Supabase 연결 안정화
- **프로덕션 최적화**: `eventsPerSecond: 10` 설정
- **에러 핸들링**: 연결 실패 시 적절한 에러 메시지
- **빌드 호환성**: 환경 변수 없이도 빌드 가능

#### 3. API 안정성 향상
- **Graceful Degradation**: 세션 없을 때 404 대신 빈 데이터 반환
- **에러 로깅**: 프로덕션 디버깅을 위한 상세 로그
- **재시도 로직**: 일시적 오류에 대한 자동 재시도

## 🌐 배포 환경 설정

### 필수 환경 변수
프로덕션 환경에서 다음 환경 변수들을 설정해야 합니다:

```bash
# Supabase 설정
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

### Vercel 배포 (권장)
1. **GitHub 연동**: 코드를 GitHub에 푸시
2. **Vercel 프로젝트 생성**: GitHub 레포지토리 연결
3. **환경 변수 설정**: Vercel 대시보드에서 위 환경 변수들 추가
4. **자동 배포**: 코드 푸시 시 자동으로 배포됨

### Netlify 배포
1. **빌드 명령어**: `npm run build`
2. **출력 디렉토리**: `.next`
3. **환경 변수**: 사이트 설정에서 환경 변수 추가

## 📊 Supabase 데이터베이스 설정

### 필수 테이블
다음 테이블들이 Supabase에 생성되어 있어야 합니다:

1. **users** - 사용자 정보
2. **game_sessions** - 게임 세션
3. **game_participants** - 게임 참가자
4. **game_rounds** - 게임 라운드
5. **player_choices** - 플레이어 선택

### Realtime 설정
Supabase 대시보드에서 다음 테이블들의 Realtime을 활성화해야 합니다:
- `game_sessions`
- `game_participants`

## 🔍 배포 후 확인 사항

### 1. 기본 기능 테스트
- [ ] 홈 페이지 로딩
- [ ] 참가자 등록 (네이버 로그인)
- [ ] 로비 입장/퇴장
- [ ] 실시간 참가자 수 업데이트

### 2. 리얼타임 동기화 테스트
- [ ] 여러 브라우저에서 동시 접속
- [ ] 한 브라우저에서 로비 입장 시 다른 브라우저에서 즉시 반영
- [ ] 네트워크 연결 끊김 후 재연결 시 정상 동작

### 3. 관리자 기능 테스트
- [ ] 운영자 페이지 접속
- [ ] 게임 세션 생성
- [ ] 참가자 관리
- [ ] 게임 시작

## 🚨 알려진 이슈 및 해결 방법

### 1. 환경 변수 미설정
**증상**: "Supabase URL 혹은 Anon Key가 설정되지 않았습니다" 에러
**해결**: 배포 플랫폼에서 환경 변수 올바르게 설정

### 2. Realtime 연결 실패
**증상**: 참가자 수가 실시간으로 업데이트되지 않음
**해결**: Supabase 대시보드에서 Realtime 기능 활성화 확인

### 3. 빌드 실패
**증상**: 환경 변수 관련 빌드 에러
**해결**: 현재 코드는 환경 변수 없이도 빌드 가능하도록 수정됨

## 📞 지원 및 문의

배포 과정에서 문제가 발생하면:
1. 브라우저 개발자 도구 콘솔 확인
2. Supabase 대시보드에서 로그 확인
3. 배포 플랫폼의 빌드 로그 확인

## 🎯 다음 주 이벤트 준비

### 사전 준비 사항
1. **Supabase 프로젝트 생성** 및 환경 변수 설정
2. **도메인 설정** (선택사항)
3. **참가자 명단** 준비 (네이버 ID 리스트)
4. **게임 규칙** 최종 확인

### 이벤트 당일
1. **관리자 페이지**에서 게임 세션 생성
2. **참가자 등록** 및 로비 입장 안내
3. **실시간 모니터링** (참가자 수, 연결 상태)
4. **게임 진행** 및 결과 확인

---

**🎮 게임이 성공적으로 진행되길 바랍니다!**
